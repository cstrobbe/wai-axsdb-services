<?xml version="1.0" encoding = "UTF-8"?>
<project default="info" basedir="." >
    <!-- Properties file -->
    <property file="install.properties" />
	<path id="local.classpath">
		<fileset dir="${local.war.folder}/WEB-INF/lib/">
	  		<include name="**/*.jar"/>
		</fileset>
        <pathelement location="${local.war.folder}/WEB-INF/classes/"/>
	</path>
	<path id="remote.classpath">
		<fileset dir="${remote.war.folder}/WEB-INF/lib/">
	  		<include name="**/*.jar"/>
		</fileset>
        <pathelement location="${remote.war.folder}/WEB-INF/classes/"/>
	</path>
	
	<target name="remote-webapp-deploy">
		<echo message="Deploying the Web app to roxie." />
		<!-- rename -->
		<move file="${local.war.path}/${local.war.filename}" tofile="${local.war.path}/${remote.war.filename}"/>
		<scp trust="true"  
			failonerror="true"
			keyfile="${user.home}/${local.key.file}"
			passphrase="${local.key.pass}"
            verbose="true"
			file="${local.war.path}/${remote.war.filename}"
            todir="${remote.user}@${remote.host}:${remote.war.path}">
		</scp>
	</target> 
	<target name="local-db-populate">
		<echo message="Init DB" />
		<property name="myclasspath" refid="local.classpath"/>
		<echo message="Classpath = ${myclasspath}"/>
		<java
			classname="${webapp.admin.class}">
	         <arg value="init-all"/>
	         <classpath refid="local.classpath" />
		</java>
	</target>
	<target name="remote-jetty-restart">
		<echo message="jetty restart in roxie" />
		<sshexec host="${remote.host}"
			failonerror="true"
			keyfile="${user.home}/${local.key.file}"
			passphrase="${local.key.pass}"
            verbose="true"
			command="/etc/init.d/jetty restart"/>
	</target>
	<target name="remote-db-populate">
		<echo message="polulate db in roxie" />
		<property name="myclasspath" refid="remote.classpath"/>
		<echo message="Classpath = ${myclasspath}"/>
		<property name="remote.classes" location="${remote.war.folder}/WEB-INF/classes/"/>
		<sshexec host="${remote.user}@${remote.host}:${remote.classes}"
			failonerror="true"
			keyfile="${user.home}/${local.key.file}"
			passphrase="${local.key.pass}"
            verbose="true"
			command="java -c ${remote.classpath} ${webapp.admin.class} init-all"/>
	</target>
		
	<!-- ================================= 
          target: info
         ================================= -->
    <target name="info" description="Default informative task">
        <echo>Help for axsdb setup and admin.</echo>
    </target>
</project>